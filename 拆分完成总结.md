# Bazaar_Lens.py æ¨¡å—æ‹†åˆ†å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„æ¨¡å—æ‹†åˆ†

### 1. é…ç½®ç®¡ç†æ¨¡å—
- **config.py** - ConfigManager ç±»
  - é…ç½®æ–‡ä»¶è¯»å†™
  - Tesseractè·¯å¾„ç®¡ç†

### 2. æ—¥å¿—ç®¡ç†æ¨¡å—
- **logger.py**
  - get_log_file_path() - è·å–æ—¥å¿—æ–‡ä»¶è·¯å¾„
  - setup_logging() - è®¾ç½®æ—¥å¿—ç³»ç»Ÿ
  - hide_console() / show_console() - æ§åˆ¶å°æ˜¾ç¤ºæ§åˆ¶
  - is_packaged_environment() - ç¯å¢ƒæ£€æµ‹

### 3. OCRåŠŸèƒ½æ¨¡å—
- **ocr.py**
  - ocr_task() - OCRä»»åŠ¡å‡½æ•°
  - direct_ocr() - ç›´æ¥OCRå‡½æ•°

### 4. UIç»„ä»¶æ¨¡å—
- **ui/__init__.py** - æ¨¡å—åˆå§‹åŒ–
- **ui/components.py**
  - IconFrame ç±» - å›¾æ ‡å’Œæ–‡æœ¬æ˜¾ç¤ºæ¡†æ¶
  - ScrollableFrame ç±» - å¯æ»šåŠ¨æ¡†æ¶

### 5. æ•°æ®ç®¡ç†æ¨¡å—
- **data/__init__.py** - æ¨¡å—åˆå§‹åŒ–
- **data/loader.py** - DataLoader ç±»
  - load_monster_data() - åŠ è½½æ€ªç‰©æ•°æ®
  - load_event_data() - åŠ è½½äº‹ä»¶æ•°æ®
  - load_items_data() - åŠ è½½ç‰©å“æ•°æ®
  - load_skills_data() - åŠ è½½æŠ€èƒ½æ•°æ®
- **data/matcher.py** - TextMatcher ç±»ï¼ˆå ä½ï¼Œéœ€è¦ä»ä¸»ç¨‹åºæå–å®Œæ•´é€»è¾‘ï¼‰

### 6. æ¸¸æˆç›¸å…³æ¨¡å—
- **game/__init__.py** - æ¨¡å—åˆå§‹åŒ–
- **game/position.py** - PositionConfig ç±»
  - load_position_config() - åŠ è½½ä½ç½®é…ç½®
  - calculate_relative_offset() - è®¡ç®—ç›¸å¯¹åç§»
- **game/monitor.py** - LogMonitor ç±»ï¼ˆå ä½ï¼Œéœ€è¦ä»ä¸»ç¨‹åºæå–å®Œæ•´é€»è¾‘ï¼‰

### 7. ç³»ç»ŸåŠŸèƒ½æ¨¡å—
- **system/__init__.py** - æ¨¡å—åˆå§‹åŒ–
- **system/admin.py** - ç®¡ç†å‘˜æƒé™
  - is_admin() - æ£€æŸ¥ç®¡ç†å‘˜æƒé™
  - run_as_admin() - ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œ
- **system/tray.py** - SystemTray ç±»ï¼ˆå ä½ï¼Œéœ€è¦ä»ä¸»ç¨‹åºæå–å®Œæ•´é€»è¾‘ï¼‰
- **system/update.py** - UpdateChecker ç±»ï¼ˆå ä½ï¼Œéœ€è¦ä»ä¸»ç¨‹åºæå–å®Œæ•´é€»è¾‘ï¼‰

## ğŸ“‹ ä¸‹ä¸€æ­¥å·¥ä½œ

### 1. å®Œå–„å ä½æ¨¡å—
ä»¥ä¸‹æ¨¡å—éœ€è¦ä» `Bazaar_Lens.py` ä¸­æå–å®Œæ•´å®ç°ï¼š

- **data/matcher.py** - æ–‡æœ¬åŒ¹é…é€»è¾‘
  - fuzzy_match_game_text() å‡½æ•°
  - find_best_match() å‡½æ•°
  - å…¶ä»–åŒ¹é…ç›¸å…³å‡½æ•°

- **game/monitor.py** - æ¸¸æˆæ—¥å¿—ç›‘æ§
  - _monitor_log() æ–¹æ³•å®Œæ•´å®ç°
  - æ—¥å¿—è§£æé€»è¾‘

- **system/tray.py** - ç³»ç»Ÿæ‰˜ç›˜
  - _create_tray_icon() å®Œæ•´å®ç°
  - æ‰˜ç›˜èœå•å’Œäº‹ä»¶å¤„ç†

- **system/update.py** - æ›´æ–°æ£€æŸ¥
  - check_update() å®Œæ•´å®ç°
  - should_check_update() å®Œæ•´å®ç°

### 2. é‡æ„ä¸»ç¨‹åº
éœ€è¦æ›´æ–° `Bazaar_Lens.py`ï¼š

1. **æ›´æ–°å¯¼å…¥è¯­å¥**
   ```python
   from config import ConfigManager
   from logger import setup_logging, is_packaged_environment
   from ocr import ocr_task, direct_ocr
   from ui import IconFrame, ScrollableFrame
   from data import DataLoader
   from data.matcher import TextMatcher
   from game.position import PositionConfig
   from game.monitor import LogMonitor
   from system.admin import is_admin, run_as_admin
   from system.tray import SystemTray
   from system.update import UpdateChecker
   ```

2. **é‡æ„ BazaarHelper ç±»**
   - ä½¿ç”¨ DataLoader æ›¿ä»£ç›´æ¥çš„æ•°æ®åŠ è½½æ–¹æ³•
   - ä½¿ç”¨ PositionConfig æ›¿ä»£ä½ç½®é…ç½®æ–¹æ³•
   - ä½¿ç”¨ LogMonitor æ›¿ä»£æ—¥å¿—ç›‘æ§æ–¹æ³•
   - ä½¿ç”¨ SystemTray æ›¿ä»£ç³»ç»Ÿæ‰˜ç›˜åˆ›å»º
   - ä½¿ç”¨ UpdateChecker æ›¿ä»£æ›´æ–°æ£€æŸ¥

3. **ç§»é™¤å·²æ‹†åˆ†çš„ä»£ç **
   - åˆ é™¤å·²æ‹†åˆ†åˆ°å…¶ä»–æ¨¡å—çš„ç±»å’Œæ–¹æ³•
   - ä¿ç•™ BazaarHelper ä¸»ç±»å’Œç¨‹åºå…¥å£

### 3. æµ‹è¯•å’ŒéªŒè¯
- æµ‹è¯•æ¯ä¸ªæ¨¡å—çš„å¯¼å…¥æ˜¯å¦æ­£å¸¸
- æµ‹è¯•åŠŸèƒ½æ˜¯å¦å®Œæ•´
- ä¿®å¤å¯èƒ½çš„å¾ªç¯å¯¼å…¥é—®é¢˜
- ç¡®ä¿æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

## ğŸ“ æ–°çš„ç›®å½•ç»“æ„

```
bazaardb-desktop/
â”œâ”€â”€ config.py              # é…ç½®ç®¡ç†
â”œâ”€â”€ logger.py              # æ—¥å¿—ç®¡ç†
â”œâ”€â”€ ocr.py                 # OCRåŠŸèƒ½
â”œâ”€â”€ ui/                    # UIç»„ä»¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ components.py
â”œâ”€â”€ data/                  # æ•°æ®ç®¡ç†
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ loader.py
â”‚   â””â”€â”€ matcher.py
â”œâ”€â”€ game/                  # æ¸¸æˆç›¸å…³
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ position.py
â”‚   â””â”€â”€ monitor.py
â”œâ”€â”€ system/                # ç³»ç»ŸåŠŸèƒ½
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ admin.py
â”‚   â”œâ”€â”€ tray.py
â”‚   â””â”€â”€ update.py
â””â”€â”€ Bazaar_Lens.py         # ä¸»ç¨‹åºï¼ˆå¾…é‡æ„ï¼‰
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¾ªç¯å¯¼å…¥**ï¼šç¡®ä¿æ¨¡å—ä¹‹é—´æ²¡æœ‰å¾ªç¯å¯¼å…¥
2. **ç›¸å¯¹å¯¼å…¥**ï¼šä½¿ç”¨ç›¸å¯¹å¯¼å…¥æ—¶æ³¨æ„è·¯å¾„é—®é¢˜
3. **ä¾èµ–å…³ç³»**ï¼šæ³¨æ„æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»
4. **æµ‹è¯•**ï¼šæ¯ä¸ªæ¨¡å—æ‹†åˆ†åéƒ½è¦æµ‹è¯•åŠŸèƒ½æ˜¯å¦æ­£å¸¸

## ğŸ¯ å®ŒæˆçŠ¶æ€

- âœ… æ¨¡å—ç»“æ„åˆ›å»ºå®Œæˆ
- âœ… åŸºç¡€åŠŸèƒ½æ¨¡å—æ‹†åˆ†å®Œæˆ
- â³ å ä½æ¨¡å—éœ€è¦å®Œå–„
- â³ ä¸»ç¨‹åºéœ€è¦é‡æ„
- â³ éœ€è¦æµ‹è¯•éªŒè¯
