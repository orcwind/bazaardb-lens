# Bazaar_Lens 日志文件说明

## 📝 日志配置

### 日志文件位置
- **文件名**: `bazaar_helper.log`
- **位置**: 程序运行目录（与 `Bazaar_Lens.exe` 同一目录）
- **编码**: UTF-8

### 日志级别
- **INFO**: 正常运行信息
- **WARNING**: 警告信息
- **ERROR**: 错误信息
- **DEBUG**: 调试信息（需要修改代码启用）

## 📋 日志内容

### 程序启动
```
2025-10-13 10:00:00 - INFO - 检测到打包环境，使用简化OCR策略
2025-10-13 10:00:00 - INFO - Tesseract OCR路径设置为: C:\Program Files\Tesseract-OCR\tesseract.exe
2025-10-13 10:00:01 - INFO - 成功加载怪物数据，共 724 个怪物
2025-10-13 10:00:01 - INFO - 已加载 39 个事件
```

### OCR识别
```
2025-10-13 10:01:00 - INFO - OCR文本行: ['prince marianas', 'electric eels']
2025-10-13 10:01:00 - INFO - 找到最佳匹配: monster - Prince Marianas (相似度: 0.85)
```

### 图标加载
```
2025-10-13 10:01:01 - DEBUG - 技能图标路径: icons/Prince Marianas_Electric Eels.webp -> D:\...\icons\Prince Marianas_Electric Eels.webp
2025-10-13 10:01:01 - DEBUG - 找到怪物图标: D:\...\monster_details_v3\icons\Prince Marianas_Electric Eels.webp
```

### 错误信息
```
2025-10-13 10:02:00 - ERROR - 获取游戏窗口失败: [Errno 2] No such file or directory
2025-10-13 10:02:00 - ERROR - OCR识别超时，已跳过本次识别
2025-10-13 10:02:00 - WARNING - 未找到游戏窗口
```

## 🔍 查看日志

### 方法1：使用记事本
1. 打开程序安装目录
2. 找到 `bazaar_helper.log` 文件
3. 右键 → 打开方式 → 记事本

### 方法2：使用命令行
```bash
# 查看最后50行
type bazaar_helper.log | more

# 或使用 PowerShell
Get-Content bazaar_helper.log -Tail 50
```

### 方法3：实时监控（PowerShell）
```powershell
Get-Content bazaar_helper.log -Wait -Tail 20
```

## 🐛 常见问题排查

### 问题1：程序无法启动
**查看日志中的错误**：
```
ERROR - 加载怪物数据失败
ERROR - 找不到 6.0/crawlers/monster_details_v3/monsters_v3.json
```
**解决**：检查数据文件是否存在

### 问题2：OCR无法识别
**查看日志**：
```
ERROR - 检查Tesseract OCR时出错
WARNING - 无效的图标URL
```
**解决**：检查 Tesseract OCR 是否正确安装

### 问题3：图标不显示
**查看日志**：
```
DEBUG - 技能图标路径: icons/xxx.webp -> None
ERROR - 加载图标失败: [Errno 2] No such file or directory
```
**解决**：检查图标文件是否存在

### 问题4：窗口检测失败
**查看日志**：
```
WARNING - 未找到游戏窗口
INFO - 找到的所有 Bazaar 相关窗口: []
```
**解决**：确保游戏正在运行且窗口可见

## 📊 日志文件管理

### 日志文件大小
- 正常使用：约 1-5 MB/天
- 频繁使用：约 10-20 MB/天

### 清理日志
日志文件会持续追加，建议定期清理：

1. **手动清理**：
   - 关闭程序
   - 删除或重命名 `bazaar_helper.log`
   - 重新启动程序会创建新日志

2. **备份日志**：
   ```bash
   # 重命名旧日志
   ren bazaar_helper.log bazaar_helper_backup_20251013.log
   ```

## 🔧 启用调试日志

如需更详细的日志信息，修改 `Bazaar_Lens.py` 第50行：

```python
# 修改前
level=logging.INFO,

# 修改后（启用调试日志）
level=logging.DEBUG,
```

重新打包后会记录更详细的信息。

## 📤 提交问题时

如果遇到问题需要反馈，请附上日志文件：

1. 找到 `bazaar_helper.log` 文件
2. 复制最后 100-200 行
3. 或直接上传整个日志文件

## ⚙️ 控制台显示选项

虽然默认隐藏控制台窗口，但可以通过菜单启用：

1. 右键点击系统托盘图标
2. 选择 "显示控制台 Show Console"（如果菜单中有此选项）
3. 控制台窗口会显示，可以看到实时日志

**注意**：当前版本已隐藏此菜单选项，如需启用，请在 `Bazaar_Lens.py` 中取消注释相关代码。

## 📁 日志文件位置示例

**安装版本**：
```
C:\Program Files\Bazaar_Lens\bazaar_helper.log
```

**便携版本**：
```
D:\Programs\Bazaar_Lens\bazaar_helper.log
```

## 🎯 重要提示

1. ✅ 日志文件会自动创建，无需手动配置
2. ✅ 日志包含中文，使用 UTF-8 编码
3. ✅ 控制台默认隐藏，但日志文件正常生成
4. ✅ 所有错误和警告都会记录到日志文件
5. ⚠️ 日志文件可能包含敏感路径信息，分享时注意隐私

